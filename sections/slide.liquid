{{ 'slide.css' | asset_url | stylesheet_tag }}

{%- style -%}
{%- endstyle -%}

<section class="slide">
  <div class="container slide__container">
    <div class="slider">
      <div class="slider-content">
        <figure class="show">
          <img src="https://images.unsplash.com/photo-1506619216599-9d16d0903dfd?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NHx8bWluaW1hbHxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=1280&h=720" alt="Coffee">
        </figure>
        <figure>
          <img src="https://images.unsplash.com/photo-1513506003901-1e6a229e2d15?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTR8fG1pbmltYWx8ZW58MHx8MHx8&auto=format&fit=crop&w=1280&h=720" alt="Lamp">
        </figure>
        <figure>
          <img src="https://images.unsplash.com/photo-1546387903-6d82d96ccca6?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTh8fG1pbmltYWx8ZW58MHx8MHx8&auto=format&fit=crop&w=1280&h=720" alt="Plant">
        </figure>
      </div>
      <div class="slider-navigation">
        <button class="prev">
          prev
        </button>
        <button class="next">
          next
        </button>
      </div>
      <div class="slider-pagination">
        <!-- Pagination dots will be added dynamically -->
      </div>
    </div>
  </div>
</section>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var count = 0;
        var directions = {
            prev: 0,
            next: 1
        };

        var prevButton = document.querySelector(".slider-navigation .prev");
        var nextButton = document.querySelector(".slider-navigation .next");
        var sliders = document.querySelectorAll(".slider-content figure");
        var paginationContainer = document.querySelector(".slider-pagination");

        // Ensure elements exist before proceeding
        if (!prevButton || !nextButton || sliders.length === 0 || !paginationContainer) {
            console.error("Required elements are missing in the DOM.");
            return;
        }

        // Create dots dynamically
        sliders.forEach((_, index) => {
            var dot = document.createElement("div");
            dot.className = "dot";
            dot.dataset.index = index;
            paginationContainer.appendChild(dot);
        });

        var dots = document.querySelectorAll(".slider-pagination .dot");

        // Ensure dots exist before proceeding
        if (dots.length === 0) {
            console.error("Pagination dots could not be created.");
            return;
        }

        initListeners();

        function initListeners() {
            nextButton.addEventListener("click", onNavigationClick);
            prevButton.addEventListener("click", onNavigationClick);
            dots.forEach(dot => dot.addEventListener("click", onDotClick));
        }

        function onNavigationClick(e) {
            var directionIndex = e.target === nextButton ? directions.next : directions.prev;
            var controlledCount = countController(directionIndex);

            var oldSlideItem = sliders[controlledCount.old];
            var newSlideItem = sliders[controlledCount.new];

            oldSlideItem.classList.remove("show");
            dots[controlledCount.old].classList.remove("active");
            e.target.classList.add("disabled");

            setTimeout(function() {
                newSlideItem.classList.add("show");
                dots[controlledCount.new].classList.add("active");
                e.target.classList.remove("disabled");
            }, 150);
        }

        function onDotClick(e) {
            var index = parseInt(e.target.dataset.index, 10);
            if (index === count) return; // Do nothing if the clicked dot is already active

            var controlledCount = countController(index);

            var oldSlideItem = sliders[controlledCount.old];
            var newSlideItem = sliders[controlledCount.new];

            oldSlideItem.classList.remove("show");
            dots[controlledCount.old].classList.remove("active");

            newSlideItem.classList.add("show");
            dots[controlledCount.new].classList.add("active");
            count = controlledCount.new; // Update count to new slide index
        }

        function countController(directionIndex) {
            var result = { new: 0, old: count };
            var max = sliders.length;

            if (typeof directionIndex === 'number') {
                if (directionIndex === directions.next) {
                    count = count === max - 1 ? 0 : (count + 1);
                }

                if (directionIndex === directions.prev) {
                    count = count === 0 ? (max - 1) : (count - 1);
                }
            } else {
                count = directionIndex;
            }

            result.new = count;

            return result;
        }

        function getElementIndex(element) {
            return Array.from(element.parentElement.children).indexOf(element);
        }

        // Initialize the first dot as active
        dots[0].classList.add("active");
    });
</script>
{% schema %}
{
  "name": "Slide",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "settings": [
    {
      "type": "color",
      "id": "backgroundColor",
      "label": "Background color",
      "default": "#F7F7F7"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Slide"
    }
  ]
}
{% endschema %}